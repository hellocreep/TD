<?php
$outtype = isset($type)? $type : 1;
    $ids = isset($ids)? explode(",",$ids) : array();
    $outnofind = isset($outnofind)? $outnofind : '';
    $pageurl = isset($pageurl)? $pageurl : 0;
    $picformat = array(
        '170' => array(
            'width'=>' width="170"',
            'height'=>' height="136"',
            'class'=>' class="c3"'
        ),
        '250' => array(
            'width'=>' width="250"',
            'height'=>' height="200"',
            'class'=>' class="c2"'
        ),
        '480' => array(
            'width'=>'',
            'height'=>'',
            'class'=>' class="c1"'
        )
    );
    if(!empty($ids)){
        if((count($ids)==1)||$outtype==1){
            $tva = array('longtitle','description','widthm','widthb');
            $pfm = $picformat['480'];
        }else{
            $tva = array('longtitle','description','widths','widthb');
            switch($outtype){
                case 2:
                    $pfm = $picformat['250'];
                    break;
                case 3:
                    $pfm = $picformat['170'];
                    break;
                default:
                    $pfm = $picformat['480'];
            }
        }
        $outpichtml = '';
        $mm=1;
        if($pageurl){
            foreach($ids as $i){
                $res=$modx->getTemplateVarOutput($tva,$i,1);
                $picurl = $res['widths']? $res['widths'] : $res['widthm'];
                $outpichtml = $outpichtml.'<li'.$pfm['class'].'><a title="'.$res['longtitle'].'" href="'.$modx->makeUrl($i).'" target="_blank"><img'.$pfm['width'].$pfm['height'].' alt="'.$res['longtitle'].'" src="'.$picurl.'"/></a><br/>'.$res['description'].'</li>';
                if($mm==$outtype){
                    $outpichtml = $outpichtml.'<br clear="all"/>';
                    $mm=0;
                };
                $mm++;
            };
        }else{
            foreach($ids as $i){
                $res=$modx->getTemplateVarOutput($tva,$i,1);
                $picurl = $res['widths']? $res['widths'] : $res['widthm'];
                $outpichtml = $outpichtml.'<li'.$pfm['class'].'><a rel="lightbox[tibet]" title="'.$res['longtitle'].'" href="'.$res['widthb'].'"><img'.$pfm['width'].$pfm['height'].' alt="'.$res['longtitle'].'" src="'.$picurl.'"/></a><br/>'.$res['description'].'</li>';
                if($mm==$outtype){
                    $outpichtml = $outpichtml.'<br clear="all"/>';
                    $mm=0;
                };
                $mm++;
            };
        }
        if((count($ids)%$outtype<>0)&&(count($ids)>1)) $outpichtml = $outpichtml.'<br clear="all"/>';
        $outpichtml = '<ul class="photoblock">'.$outpichtml.'</ul>';
    }else $outpichtml = $outnofind;
    echo $outpichtml;
?>